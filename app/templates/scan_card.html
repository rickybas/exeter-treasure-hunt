{% extends "bootstrap/base.html" %}

<!-- {% block html_attribs %} lang="en"{% endblock %} -->
{% block title %}{{ APP_NAME }} - Scan card{% endblock %}

{% block styles %}
    <link rel="stylesheet" type='text/css'
          href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/style.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/bootstrap.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='icon.ico') }}"/>
    <script src="https://rawgit.com/schmich/instascan-builds/master/instascan.min.js"></script>

{% endblock %}

{% block scripts %}
    {{ super() }}
{% endblock %}

{% block navbar %}
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
        <a class="navbar-brand" href="/">{{ APP_NAME }}</a>
        <button class="float-right btn btn-success my-2 my-lg-0" onclick="location.href='/';"
                style="margin-left: auto;width:100px;">Close
        </button>
    </nav>
{% endblock %}


{% block content %}
    <div class="container">
        <video id="preview"></video>
        <script type="text/javascript">
            let scanner = new Instascan.Scanner({ video: document.getElementById('preview') });
            scanner.addListener('scan', function (content) {
                var card =(content);
                $.post("/scan-card/"+card,
                    function (data, status) {
                        alert(data);
                        location.href = "/";
                    });
            });

            Instascan.Camera.getCameras().then(function (cameras) {
                if (cameras.length > 0) {
                    scanner.start(cameras[0]);
                } else {
                    console.error('No cameras found.');
                }
            }).catch(function (e) {
                console.error(e);
            });
        </script>
    </div>

    <footer class="footer">
        <div class="container text-center">
            <span class="text-muted">{{ APP_NAME }} - {{ VERSION }}</span>
        </div>
    </footer>
{% endblock %}